import{r as c,u as D,j as e,H as S}from"./app-DunL67i5.js";import{A as T}from"./AuthenticatedLayout-DsF5GDms.js";import{I as n}from"./InputLabel-xFqURKT9.js";import{T as g}from"./TextInput-Bu0Qnh1u.js";import{P as A}from"./PrimaryButton-BJgCm3lz.js";import"./ApplicationLogo-CyyW8wRQ.js";import"./transition-aFF6rh6z.js";function H(){const[u,m]=c.useState([]),[f,v]=c.useState(!0),[x,h]=c.useState(null),[j,y]=c.useState([]),[k,_]=c.useState(!0),[b,p]=c.useState(null),{data:a,setData:d,post:L,processing:N,errors:o}=D({name:"",code:"",description:"",delivery_type:"office",country:"",city:"",trainer_id:"",coordinator_id:"",location_id:"",location_details:""});c.useEffect(()=>{v(!0),h(null);const r=window.location.origin,l=`${r}/api/trainers`;console.log("Debug - Current location:",window.location.href),console.log("Debug - Base URL:",r),console.log("Debug - API URL:",l),fetch(l).then(t=>{if(console.log("Debug - Response status:",t.status),console.log("Debug - Response ok:",t.ok),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{console.log("Debug - Response data:",t),t&&t.data&&Array.isArray(t.data)?(console.log("Debug - Setting trainers:",t.data),m(t.data)):(console.log("Debug - Invalid data structure:",t),m([]),h("Invalid trainer data received"))}).catch(t=>{console.error("Error fetching trainers:",t),h("Failed to load trainers"),m([])}).finally(()=>{v(!1)})},[]),c.useEffect(()=>{_(!0),p(null);const l=`${window.location.origin}/api/training-halls`;console.log("Debug - Fetching locations from:",l),fetch(l).then(t=>{if(console.log("Debug - Locations response status:",t.status),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{console.log("Debug - Locations response data:",t),t&&t.data&&Array.isArray(t.data)?(console.log("Debug - Setting locations:",t.data),y(t.data)):(console.log("Debug - Invalid locations data structure:",t),y([]),p("Invalid location data received"))}).catch(t=>{console.error("Error fetching locations:",t),p("Failed to load locations"),y([])}).finally(()=>{_(!1)})},[]);const C=r=>{var w;r.preventDefault(),console.log("Debug - Submitting course data:",a);const l=window.location.origin,t=`${l}/courses`;console.log("Debug - Submitting to URL:",t);const i=new FormData;i.append("name",a.name),i.append("code",a.code),i.append("description",a.description),i.append("delivery_type",a.delivery_type),i.append("country",a.country),i.append("city",a.city),i.append("trainer_id",a.trainer_id),i.append("coordinator_id",a.coordinator_id),i.append("location_id",a.location_id),i.append("location_details",a.location_details),fetch(t,{method:"POST",headers:{"X-CSRF-TOKEN":((w=document.querySelector('meta[name="csrf-token"]'))==null?void 0:w.getAttribute("content"))||""},body:i}).then(s=>{if(console.log("Debug - Submit response status:",s.status),console.log("Debug - Submit response headers:",s.headers),s.redirected)window.location.href=s.url;else{if(s.ok)return s.text();throw new Error(`HTTP error! status: ${s.status}`)}}).then(s=>{console.log("Debug - Submit result:",s),window.location.href=`${l}/courses`}).catch(s=>{console.error("Error submitting course:",s)})};return e.jsxs(T,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:"📚 Create New Course"}),children:[e.jsx(S,{title:"Create Course"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg dark:bg-gray-800",children:e.jsx("div",{className:"p-6 text-gray-900 dark:text-gray-100",children:e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"name",value:"Course Name"}),e.jsx(g,{id:"name",type:"text",name:"name",value:a.name,className:"mt-1 block w-full",onChange:r=>d("name",r.target.value),required:!0}),o.name&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.name})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"code",value:"Course Code"}),e.jsx(g,{id:"code",type:"text",name:"code",value:a.code,className:"mt-1 block w-full",onChange:r=>d("code",r.target.value),placeholder:"e.g., PMC2024"}),o.code&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.code})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",value:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:a.description,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600",rows:3,onChange:r=>d("description",r.target.value),placeholder:"Brief description of the course..."}),o.description&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.description})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"delivery_type",value:"Delivery Type"}),e.jsxs("select",{id:"delivery_type",name:"delivery_type",value:a.delivery_type,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600",onChange:r=>d("delivery_type",r.target.value),children:[e.jsx("option",{value:"office",children:"Office"}),e.jsx("option",{value:"offsite",children:"Offsite"}),e.jsx("option",{value:"abroad",children:"Abroad"})]}),o.delivery_type&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.delivery_type})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"country",value:"Country"}),e.jsx(g,{id:"country",type:"text",name:"country",value:a.country,className:"mt-1 block w-full",onChange:r=>d("country",r.target.value),placeholder:"e.g., France"}),o.country&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.country})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"city",value:"City"}),e.jsx(g,{id:"city",type:"text",name:"city",value:a.city,className:"mt-1 block w-full",onChange:r=>d("city",r.target.value),placeholder:"e.g., Paris"}),o.city&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.city})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"📍 Course Location"}),k&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Loading locations..."})]}),b&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400",children:["⚠️ ",b,". Please refresh the page or try again later."]})}),!k&&!b&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"location_id",value:"Training Location"}),e.jsxs("select",{id:"location_id",name:"location_id",value:a.location_id,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600",onChange:r=>d("location_id",r.target.value),children:[e.jsx("option",{value:"",children:"Select Training Location"}),Array.isArray(j)&&j.map(r=>e.jsxs("option",{value:r.id,children:["📍"," ",r.name," ","-"," ",r.city,","," ",r.country]},r.id))]}),o.location_id&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.location_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"location_details",value:"Additional Location Details"}),e.jsx(g,{id:"location_details",type:"text",name:"location_details",value:a.location_details,className:"mt-1 block w-full",onChange:r=>d("location_details",r.target.value),placeholder:"e.g., Building A, Floor 3, Room 301"}),o.location_details&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.location_details})]})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"💡 Select a training location from your configured locations. You can also add specific details like room numbers or building information."})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"👨‍🏫 Trainer Assignment"}),f&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Loading trainers..."})]}),x&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400",children:["⚠️ ",x,". Please refresh the page or try again later."]})}),!f&&!x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"trainer_id",value:"Main Trainer"}),e.jsxs("select",{id:"trainer_id",name:"trainer_id",value:a.trainer_id,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600",onChange:r=>d("trainer_id",r.target.value),children:[e.jsx("option",{value:"",children:"Select Main Trainer"}),Array.isArray(u)&&u.map(r=>e.jsxs("option",{value:r.id,children:[r.full_name," ","-"," ",r.position]},r.id))]}),o.trainer_id&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.trainer_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"coordinator_id",value:"Course Coordinator"}),e.jsxs("select",{id:"coordinator_id",name:"coordinator_id",value:a.coordinator_id,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600",onChange:r=>d("coordinator_id",r.target.value),children:[e.jsx("option",{value:"",children:"Select Coordinator (Optional)"}),Array.isArray(u)&&u.map(r=>e.jsxs("option",{value:r.id,children:[r.full_name," ","-"," ",r.position]},r.id))]}),o.coordinator_id&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:o.coordinator_id})]})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"💡 Assign trainers to this course. The main trainer will lead the course, while the coordinator handles logistics and administration."})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[e.jsx("a",{href:route("courses.index"),className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-widest text-gray-700 shadow-sm transition duration-150 ease-in-out hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:border-gray-500 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 dark:focus:ring-offset-gray-800",children:"Cancel"}),e.jsx(A,{disabled:N,children:N?"Creating...":"Create Course"})]})]})})})})})]})}export{H as default};
